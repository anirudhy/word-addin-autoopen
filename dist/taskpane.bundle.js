(()=>{const e="wss://fundic-erinn-uncreative.ngrok-free.dev";let t,n,o,c,i,s,r,a,d=null,l=0;function u(e,t="info"){const n=`[${(new Date).toLocaleTimeString("en-US",{hour12:!1,hour:"2-digit",minute:"2-digit",second:"2-digit",fractionalSecondDigits:3})}] ${e}`;if(console.log(`[project1] [${t.toUpperCase()}] ${n}`),o){const e=document.createElement("div");e.className=`log-entry ${t}`,e.textContent=n,o.appendChild(e),o.scrollTop=o.scrollHeight}}function f(e){t.className=`status ${e}`;const o={connected:"Connected to WebSocket",connecting:"Connecting...",disconnected:"Disconnected",disabled:"WebSocket Disabled (Testing Mode)"};n.textContent=o[e]||e,u(`[WS STATUS] ${o[e]||e}`,"info")}function O(){if(u("[WS] connectWebSocket() called","info"),d&&u(`[WS] Existing WebSocket state: ${["CONNECTING","OPEN","CLOSING","CLOSED"][d.readyState]}`,"info"),!d||d.readyState!==WebSocket.CONNECTING&&d.readyState!==WebSocket.OPEN){f("connecting"),u(`[WS] Attempting connection to ${e}`,"info");try{d=new WebSocket(e),u("[WS] WebSocket object created successfully","info"),d.onopen=()=>{l=0,f("connected"),u("[WS] ✓ WebSocket CONNECTED","received");const e={type:"ping",source:"client-side-settings",timestamp:Date.now()};u(`[WS] Sending initial ping: ${JSON.stringify(e)}`,"sent"),d.send(JSON.stringify(e))},d.onmessage=e=>{u(`[WS] ⬇ Message received (${e.data.length} bytes)`,"received");try{const t=JSON.parse(e.data);u(`[WS] Parsed message type: ${t.type}`,"received"),u(`[WS] Full message: ${JSON.stringify(t)}`,"info"),"execute"===t.type?(u(`[WS] Execute command received - action: ${t.action}`,"received"),async function(e){u(`[WORD CMD] Executing command: ${e.action}`,"sent"),u(`[WORD CMD] Command data: ${JSON.stringify(e.data||{})}`,"info"),u(`[WORD CMD] Command ID: ${e.commandId||"N/A"}`,"info");try{await Word.run(async t=>{const{action:n,data:o}=e;switch(u("[WORD CMD] Word.run context established","info"),n){case"insertText":u(`[WORD CMD] Inserting text: "${o.text}" at location: ${o.location||"end"}`,"info"),t.document.body.insertText(o.text,o.location||Word.InsertLocation.end).font.color="blue",u("[WORD CMD] Text range created, color set to blue","info");break;case"getSelection":u("[WORD CMD] Getting current selection","info");const e=t.document.getSelection();e.load("text"),await t.sync(),u(`[WORD CMD] Selection text: "${e.text}"`,"received");break;case"highlightText":u(`[WORD CMD] Highlighting selection with color: ${o.color||"yellow"}`,"info"),t.document.getSelection().font.highlightColor=o.color||"yellow";break;default:return void u(`[WORD CMD] ✗ Unknown action: ${n}`,"error")}if(u("[WORD CMD] Syncing changes to Word...","info"),await t.sync(),u("[WORD CMD] ✓ Sync complete","info"),d&&d.readyState===WebSocket.OPEN){const t={type:"executionResult",commandId:e.commandId,success:!0,timestamp:Date.now()};u(`[WS] ⬆ Sending success response: ${JSON.stringify(t)}`,"sent"),d.send(JSON.stringify(t))}else u(`[WS] Cannot send response - WebSocket not open (state: ${d?d.readyState:"null"})`,"error");u(`[WORD CMD] ✓ ${n} completed successfully`,"sent")})}catch(t){if(u(`[WORD CMD] ✗ ${e.action} FAILED: ${t.message}`,"error"),u(`[WORD CMD] Error stack: ${t.stack}`,"error"),d&&d.readyState===WebSocket.OPEN){const n={type:"executionResult",commandId:e.commandId,success:!1,error:t.message,timestamp:Date.now()};u(`[WS] ⬆ Sending error response: ${JSON.stringify(n)}`,"error"),d.send(JSON.stringify(n))}}}(t)):"pong"===t.type?u("[WS] Pong received from server","received"):u(`[WS] Unhandled message type: ${t.type}`,"info")}catch(t){u(`[WS] ✗ Error parsing message: ${t.message}`,"error"),u(`[WS] Raw data: ${e.data}`,"error")}},d.onerror=e=>{u("[WS] ✗ WebSocket ERROR event triggered","error"),u(`[WS] Error details: ${e.message||"No error message available"}`,"error"),u(`[WS] Error type: ${e.type}`,"error")},d.onclose=e=>{if(f("disconnected"),u("[WS] ✗ WebSocket CLOSED","error"),u(`[WS] Close code: ${e.code}, reason: "${e.reason||"No reason provided"}"`,"error"),u(`[WS] Was clean close: ${e.wasClean}`,"info"),l<5){l++;const e=3e3*Math.pow(2,l-1);u(`[WS] Will reconnect in ${e/1e3}s (attempt ${l}/5)`,"info"),setTimeout(O,e)}else u("[WS] ✗ Max reconnection attempts (5) reached - giving up","error")}}catch(e){u(`[WS] ✗ Failed to create WebSocket: ${e.message}`,"error"),u(`[WS] Stack trace: ${e.stack}`,"error"),f("disconnected")}}else u("[WS] WebSocket already connected or connecting - skipping","info")}function g(){u("[AUTO-OPEN] Enable button clicked","sent"),u("[AUTO-OPEN] Reading current setting value...","info"),u(`[AUTO-OPEN] Current value: ${Office.context.document.settings.get("Office.AutoShowTaskpaneWithDocument")}`,"info"),u("[AUTO-OPEN] Setting Office.AutoShowTaskpaneWithDocument = true","info"),Office.context.document.settings.set("Office.AutoShowTaskpaneWithDocument",!0),u("[AUTO-OPEN] Calling settings.saveAsync()...","info"),Office.context.document.settings.saveAsync(e=>{u("[AUTO-OPEN] saveAsync callback triggered","info"),u(`[AUTO-OPEN] Result status: ${e.status}`,"info"),e.status===Office.AsyncResultStatus.Succeeded?(u("[AUTO-OPEN] ✓ Setting SAVED successfully to document","received"),u("[AUTO-OPEN] Task pane will auto-open on next document load","received"),u(`[AUTO-OPEN] Verification read: ${Office.context.document.settings.get("Office.AutoShowTaskpaneWithDocument")}`,"info"),m(!0)):(u(`[AUTO-OPEN] ✗ FAILED to save: ${e.error.message}`,"error"),u(`[AUTO-OPEN] Error code: ${e.error.code}`,"error"),u(`[AUTO-OPEN] Error name: ${e.error.name}`,"error"))})}function S(){u("[AUTO-OPEN] Disable button clicked","sent"),u("[AUTO-OPEN] Reading current setting value...","info"),u(`[AUTO-OPEN] Current value: ${Office.context.document.settings.get("Office.AutoShowTaskpaneWithDocument")}`,"info"),u("[AUTO-OPEN] Setting Office.AutoShowTaskpaneWithDocument = false","info"),Office.context.document.settings.set("Office.AutoShowTaskpaneWithDocument",!1),u("[AUTO-OPEN] Calling settings.saveAsync()...","info"),Office.context.document.settings.saveAsync(e=>{u("[AUTO-OPEN] saveAsync callback triggered","info"),u(`[AUTO-OPEN] Result status: ${e.status}`,"info"),e.status===Office.AsyncResultStatus.Succeeded?(u("[AUTO-OPEN] ✓ Setting SAVED successfully to document","received"),u("[AUTO-OPEN] Task pane will NOT auto-open on next document load","received"),u(`[AUTO-OPEN] Verification read: ${Office.context.document.settings.get("Office.AutoShowTaskpaneWithDocument")}`,"info"),m(!1)):(u(`[AUTO-OPEN] ✗ FAILED to save: ${e.error.message}`,"error"),u(`[AUTO-OPEN] Error code: ${e.error.code}`,"error"),u(`[AUTO-OPEN] Error name: ${e.error.name}`,"error"))})}function m(e){u("[AUTO-OPEN] Updating UI status indicator to: "+(e?"ENABLED":"DISABLED"),"info"),s.textContent="Auto-Open: "+(e?"Enabled":"Disabled"),s.className="autoopen-status "+(e?"enabled":"disabled")}Office.onReady(e=>{console.log("[project1] [INIT] Office.onReady called",e),t=document.getElementById("wsStatus"),n=document.getElementById("wsStatusText"),o=document.getElementById("log"),c=document.getElementById("enableAutoOpen"),i=document.getElementById("disableAutoOpen"),s=document.getElementById("autoOpenStatus"),r=document.getElementById("reconnectBtn"),a=document.getElementById("clearLog"),u("=== OFFICE ADD-IN STARTING ===","info"),u(`Host: ${e.host}`,"info"),u(`Platform: ${e.platform}`,"info"),e.host===Office.HostType.Word?(u("✓ Running in Word (expected host)","info"),c.addEventListener("click",g),i.addEventListener("click",S),r.addEventListener("click",O),a.addEventListener("click",()=>{u("--- Log cleared by user ---","info"),o.innerHTML=""}),u("Event listeners attached","info"),u("Checking initial auto-open status...","info"),function(){u("[AUTO-OPEN] Checking current auto-open status...","info");try{const e=Office.context.document.settings.get("Office.AutoShowTaskpaneWithDocument");u(`[AUTO-OPEN] Retrieved setting value: ${e}`,"info"),u("[AUTO-OPEN] Type: "+typeof e,"info");const t=!0===e;u("[AUTO-OPEN] Interpreted as: "+(t?"ENABLED":"DISABLED"),"info"),m(t)}catch(e){u(`[AUTO-OPEN] ✗ Error checking status: ${e.message}`,"error"),m(!1)}}(),u("⚠️ WebSocket disabled for testing (browser security restrictions)","info"),u("✓ Auto-open feature will still work perfectly!","info"),f("disabled"),u("=== INITIALIZATION COMPLETE ===","info")):u(`✗ Unexpected host: ${e.host} (expected Word)`,"error")})})();